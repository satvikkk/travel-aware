<div class="container mx-auto p-4">
    <h2 class="text-2xl font-bold mb-4">TravelAware</h2>
    <p>Your commute safety assistant</p>
  
    <div class="flex flex-col lg:flex-row gap-6">
      <!-- Form Section -->
      <div class="lg:w-1/3">
        <form [formGroup]="routeForm" (ngSubmit)="getRoute()" class="route-input">
          <!-- Location Information -->
          <div class="two-column-layout">
            <div class="column">
                <mat-form-field class="w-full">
                    <mat-label>Start Location</mat-label>
                    <input matInput formControlName="startLocation" required 
                           placeholder="e.g., 123 Wilshire Blvd or Dodger Stadium">
                    <mat-hint>Enter an LA address, landmark, or neighborhood</mat-hint>
                    @if (routeForm.get('startLocation')?.touched && routeForm.get('startLocation')?.invalid) {
                      <mat-error>{{getErrorMessage('startLocation')}}</mat-error>
                    }
                  </mat-form-field>
                  
                  <mat-form-field class="w-full">
                    <mat-label>Destination</mat-label>
                    <input matInput formControlName="destinationLocation" required
                           placeholder="e.g., Crypto.com Arena or Hollywood">
                    <mat-hint>Enter a Los Angeles address, landmark, or ZIP code</mat-hint>
                    @if (routeForm.get('destinationLocation')?.touched && routeForm.get('destinationLocation')?.invalid) {
                      <mat-error>{{getErrorMessage('destinationLocation')}}</mat-error>
                    }
                  </mat-form-field>
            </div>
          </div>
  
          <!-- Time Filter -->
          <mat-form-field class="w-full">
            <mat-label>Time Filter</mat-label>
            <mat-select formControlName="timeFilter">
              <mat-option value="all_time">All Time</mat-option>
              <mat-option value="past_7_days">Past 7 Days</mat-option>
              <mat-option value="past_1_month">Past Month</mat-option>
              <mat-option value="past_6_months">Past 6 Months</mat-option>
              <mat-option value="past_1_year">Past Year</mat-option>
            </mat-select>
          </mat-form-field>
  
          <!-- Personal Information -->
          <div class="mt-4">
            <h3 class="text-lg font-semibold mb-4">Personal Information</h3>
            
            <div class="two-column-layout">
              <div class="column">
                <mat-form-field class="w-full">
                  <mat-label>Age</mat-label>
                  <input matInput type="number" formControlName="age" required>
                  @if (routeForm.get('age')?.touched) {
                    <mat-error>{{getErrorMessage('age')}}</mat-error>
                  }
                </mat-form-field>
              </div>
  
              <div class="column">
                <mat-form-field class="w-full">
                  <mat-label>Gender</mat-label>
                  <mat-select formControlName="gender" required>
                    <mat-option value="M">Male</mat-option>
                    <mat-option value="F">Female</mat-option>
                  </mat-select>
                  @if (routeForm.get('gender')?.touched) {
                    <mat-error>{{getErrorMessage('gender')}}</mat-error>
                  }
                </mat-form-field>
              </div>
            </div>
  
            <mat-form-field class="w-full">
              <mat-label>Travel Time</mat-label>
              <mat-select formControlName="travelTime" required>
                @for (time of timeOptions; track time.value) {
                  <mat-option [value]="time.value">{{time.label}}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
  
          <button mat-raised-button color="primary" type="submit" [disabled]="isLoading" class="w-full">
            @if (isLoading) {
              <mat-spinner diameter="20" class="inline-block mr-2"></mat-spinner>
              Calculating Routes...
            } @else {
              Get Route
            }
          </button>
  
          @if (error) {
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-4">
              {{error}}
            </div>
          }
        </form>
      </div>
  
      <!-- Map and Results Section -->
      <div class="lg:w-2/3">
        <app-map-view
          [routes]="routeData?.routes || []"
          [startLocation]="routeForm.value.startLocation"
          [destinationLocation]="routeForm.value.destinationLocation">
        </app-map-view>
  
        @if (routeData) {
          <app-route-display
            [routes]="routeData.routes"
            [startLocation]="routeForm.value.startLocation"
            [destinationLocation]="routeForm.value.destinationLocation"
            [topCrimes]="routeData.top_crimes || []"
            [isLoading]="isLoading">
          </app-route-display>
        }
      </div>
    </div>
  </div>